; Rick Companje, March 29th, 2022
cpu 8086
org 0x0

    jmp code

    db 'Sanyo1.2'
    db 0x00,0x02,0x02,0x01,0x00,0x02,0x70,0x00,
    db 0xd0,0x02,0xfd,0x02,0x00,0x09,0x00,0x02,
    db 0x00,0x00,0x00,0x00,0x00,0x1c,0x00,0xff,
    db '       Sanyo MBC-550/555        ',0x00

cols equ 80
startpos equ 4*24 + 4*cols*8

code:  
    call setDisplayMode80x25
    mov ch,0            ; t
    mov dh,0            ; y
top:
    mov cl,0            ; i
    mov di,startpos
    mov dh,0            ; y           
repeatY:
    mov dl,0            ; x
repeatX:
    mov al,cl           ; -15 is rode stip, +15 wit
    times 4 shr al,1    ; al/=16
    
    call draw_dot_color
    inc dl              ; x
    inc cl              ; i
    add di,8
    cmp dl,16
    jl repeatX
    mov dl,0
    add di,(cols-16)*8    ; skip remaining cols
    inc dh
    cmp dh,16
    jl repeatY
    inc ch              ; t
    jmp top

draw_dot_color:
    mov bx,0xf000    ; red
    call draw_dot
    or al,al
    jns .draw_blue_green  ; check sign bit for negative number
    mov al,0         ; clear dot on blue and green channel
.draw_blue_green:
    neg al
    mov bx,0xf400    ; blue
    call draw_dot
    mov bx,0x0c00    ; green
    call draw_dot
    ret

draw_dot:
    push di
    push ax
    push cx
    mov ah,al    
    or al,al
    jns .positive
    neg al
.positive:
    mov es,bx    ; vram
    and al,15    ; limit to 15 (4 bits)
    mov cl,8
    mul cl    ; ax=al*8
    mov si,ax
    add si,img
    times 4 cs movsw
    add di,(4*cols)-8
    mov si,ax
    add si,img+128
    times 4 cs movsw
    pop cx
    pop ax
    pop di
    ret

table: db fx0

fx0:
    mov al,15
    ; mul bl
    ; add al,dh
    ret

img:
    db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80
    db 0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xC0
    db 0x00,0x00,0x00,0x03,0x00,0x00,0x80,0xE0,0x00,0x00,0x00,0x03,0x00,0x00,0x80,0xE0
    db 0x00,0x00,0x03,0x07,0x00,0x00,0xE0,0xF0,0x00,0x00,0x03,0x07,0x00,0x00,0xE0,0xF0
    db 0x00,0x00,0x07,0x0F,0x00,0x80,0xF0,0xF8,0x00,0x00,0x07,0x0F,0x00,0x80,0xF0,0xF8
    db 0x00,0x03,0x0F,0x1F,0x00,0xE0,0xF8,0xFC,0x00,0x07,0x1F,0x1F,0x00,0xF0,0xFC,0xFC
    db 0x00,0x0F,0x1F,0x3F,0x80,0xF8,0xFC,0xFE,0x00,0x0F,0x3F,0x3F,0x80,0xF8,0xFE,0xFE
    db 0x07,0x1F,0x3F,0x7F,0xF0,0xFC,0xFE,0xFF,0x07,0x3F,0x7F,0x7F,0xF0,0xFE,0xFF,0xFF
    db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    db 0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00
    db 0x03,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0xE0,0x00,0x00,0x00
    db 0x07,0x00,0x00,0x00,0xF0,0x80,0x00,0x00,0x07,0x00,0x00,0x00,0xF0,0x80,0x00,0x00
    db 0x0F,0x03,0x00,0x00,0xF8,0xE0,0x00,0x00,0x1F,0x07,0x00,0x00,0xFC,0xF0,0x00,0x00
    db 0x1F,0x0F,0x00,0x00,0xFC,0xF8,0x80,0x00,0x3F,0x0F,0x00,0x00,0xFE,0xF8,0x80,0x00
    db 0x3F,0x1F,0x07,0x00,0xFE,0xFC,0xF0,0x00,0x7F,0x3F,0x07,0x00,0xFF,0xFE,0xF0,0x00

%include "lib.asm"
incbin "Sanyo-MS-DOS-2.11-minimal.img",($-$$)  ; include default disk image skipping first 512 bytes

