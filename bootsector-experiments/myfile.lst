     1                                  ; Rick Companje, April 23, 2022
     2                                  cpu 8086
     3                                  org 0x0
     4                                  
     5                                  cols equ 80
     6                                  rows equ 25
     7                                  lines equ 200
     8                                  
     9                                  setup:
    10 00000000 E85400                      call cls
    11                                  
    12                                  draw:
    13 00000003 FC                          cld
    14 00000004 BD00F0                      mov bp,0xf000   ;red
    15 00000007 8EC5                        mov es,bp
    16 00000009 31FF                        xor di,di
    17                                  
    18 0000000B 0E                          push cs
    19 0000000C 1F                          pop ds    ; mov ds,cs
    20                                  
    21 0000000D 31C0                        xor ax,ax
    22 0000000F B91000                      mov cx,16
    23 00000012 51                      y:  push cx
    24 00000013 B91000                      mov cx,16
    25                                  x:  
    26 00000016 89C8                        mov ax,cx
    27 00000018 48                          dec ax
    28 00000019 D1E0<rep 2h>                times 2 shl ax,1 ; AL*=4
    29 0000001D 05[6E00]                    add ax,img
    30 00000020 96                          xchg ax,si
    31                                  
    32 00000021 A5                          movsw
    33 00000022 A5                          movsw
    34 00000023 83C704                      add di,4
    35 00000026 E2EE                        loop x
    36 00000028 81C70002                    add di,512; 192 + 320; 192=remaining space, 320=whole row
    37 0000002C 59                          pop cx
    38 0000002D E2E3                        loop y
    39                                      
    40                                  
    41                                  ; horizontal mirrored copy in vram
    42 0000002F 31F6                        xor si,si ; start at 1st col
    43 00000031 BF0400                      mov di,4  ; start at 2nd col
    44                                  
    45 00000034 BD00F0                      mov bp,0xf000  ;source ds:si (red)
    46 00000037 8EDD                        mov ds,bp
    47 00000039 BD000C                      mov bp,0x0c00  ;dest es:di (green)
    48 0000003C 8EC5                        mov es,bp
    49                                      
    50 0000003E B98000                      mov cx,16*2*4
    51                                  
    52                                  hcopy:
    53                                  
    54                                      ; push cx
    55                                      ; mov cx,4
    56                                  lines_in_row:
    57 00000041 AC                          lodsb
    58                                  
    59 00000042 51                          push cx    ; somehow repne scasb destroys cx
    60 00000043 06                          push es
    61 00000044 57                          push di
    62                                  
    63 00000045 0E                          push cs   ; es=cs
    64 00000046 07                          pop es    ; es=cs, needed for scasb, somehow cannot use inline cs
    65                                  
    66 00000047 BF[AE00]                    mov di,lut
    67 0000004A F2AE                        repne scasb ; cmp al,es:di, inc di
    68 0000004C 2E8A4508                    cs mov al,[di+8] ; mirror using lut
    69                                  
    70 00000050 5F                          pop di
    71 00000051 07                          pop es
    72 00000052 59                          pop cx
    73                                      
    74 00000053 AA                          stosb
    75                                  
    76                                      ; loop lines_in_row
    77                                      ; pop cx
    78                                      ; add si,4 ;skip 1 column
    79                                      ; add di,4 ;skip 1 column
    80                                  
    81 00000054 E2EB                        loop hcopy
    82                                  
    83 00000056 F4                          hlt
    84                                  
    85                                  cls:
    86 00000057 B8000C                      mov ax,0x0c00
    87 0000005A B90040                      mov cx,0x4000
    88 0000005D 31FF                        xor di,di
    89 0000005F 8EC0                        mov es,ax    ; green
    90 00000061 F3AA                        rep stosb
    91 00000063 B4F0                        mov ah,0xf0
    92 00000065 8EC0                        mov es,ax    ;  red + blue 
    93 00000067 31FF                        xor di,di
    94 00000069 B580                        mov ch,0x80
    95 0000006B F3AA                        rep stosb
    96 0000006D C3                          ret
    97                                      
    98                                  img: 
    99 0000006E 00000000                    db 0, 0, 0, 0
   100 00000072 00000001                    db 0, 0, 0, 1         ;punt
   101 00000076 00000003                    db 0, 0, 0, 3         ;min
   102 0000007A 00000103                    db 0, 0, 1, 3         ;plus
   103 0000007E 00000307                    db 0, 0, 3, 7         ;hoed
   104 00000082 00000707                    db 0, 0, 7, 7         ;blok
   105 00000086 0001070F                    db 0, 1, 7, 15        ;ster
   106 0000008A 00030F0F                    db 0, 3, 15, 15       ;dikke plus
   107 0000008E 000F1F3F                    db 0, 15, 31, 63   
   108 00000092 011F3F3F                    db 1, 31, 63, 63      ;tol
   109 00000096 071F1F3F                    db 7, 31, 31, 63      ;robothoofd
   110 0000009A 0F1F3F3F                    db 15, 31, 63, 63
   111 0000009E 0F3F3F7F                    db 15, 63, 63, 127
   112 000000A2 1F3F7F7F                    db 31, 63, 127, 127
   113 000000A6 1F7FFFFF                    db 31, 127, 255, 255
   114 000000AA 3F7FFFFF                    db 63, 127, 255, 255
   115                                  
   116                                  lut:
   117 000000AE 000103070F1F3F7FFF          db 0,1,3,7,15,31,63,127,255
   118 000000B7 000080C0E0F0F8FCFE          db 0,0,128,192,224,240,248,252,254
