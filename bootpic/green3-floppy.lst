     1                                  org 0
     2                                  cpu 8086
     3                                  
     4                                  RED   equ 0xf000
     5                                  GREEN equ 0x1c00
     6                                  BLUE  equ 0xf400
     7                                  COLS  equ 72
     8                                  
     9                                  ROM equ 0xFE00
    10                                  FONT equ 0xFF00
    11                                  
    12                                  LINES_PER_ROW equ 4
    13                                  COLS_PER_ROW equ 72
    14                                  
    15                                  ; DISK_STATUS equ 0x08
    16                                  ; DISK_CMD equ 0x08
    17                                  ; DISK_SECTOR equ 0x0C
    18                                  ; DISK_DATA equ 0x0E
    19                                  
    20                                  ; SEG_DST equ 0x0038
    21                                  ; SEG_DST equ RED
    22                                  
    23                                  PPI equ 0x1E
    24                                  
    25 00000000 EB1B                    jmp setup
    26                                  
    27 00000002 53616E796F312E3202-     db 'Sanyo1.2',2,0,1,0,0,2,112,0,0,0,2,0,253,2,0,9,0,2,0
    27 0000000B 000100000270000000-
    27 00000014 0200FD020009000200 
    28                                  
    29                                  ; row: db 0
    30                                  ; col: db 0
    31                                  
    32                                  setup:
    33 0000001D B800F0                    mov ax,RED
    34 00000020 8EC0                      mov es,ax                  ; segment for data from floppy
    35 00000022 31FF                      xor di,di
    36                                  
    37                                  
    38                                  
    39                                  DISK_STATUS equ 0x08
    40                                  DISK_CMD equ 0x08
    41                                  DISK_TRACK equ 0x0A
    42                                  DISK_SECTOR equ 0x0C
    43                                  DISK_DATA equ 0x0E
    44                                  
    45 00000024 B098                    mov al,0x98
    46 00000026 E61E                    out PPI,al                ; PPI control: 0b10011000 (0x98) 'strobe'
    47                                  
    48                                  
    49 00000028 B800F0                  MOV AX, RED         ; Zet de segment van de schermbuffer
    50 0000002B 8EC0                    MOV ES, AX          ; Zet ES naar 0xF400 (segment voor buffer)
    51 0000002D 31FF                    XOR DI, DI          ; Zet offset in de buffer op 0
    52                                  
    53 0000002F B000                    MOV AL, 0           ; Selecteer Track 0
    54 00000031 E60A                    OUT DISK_TRACK, AL  ; Schrijf track naar floppy controller
    55                                  
    56 00000033 B001                    MOV AL, 1           ; Selecteer Sector 1
    57 00000035 E60C                    OUT DISK_SECTOR, AL ; Schrijf sector naar floppy controller
    58                                  
    59 00000037 B080                    MOV AL, 0x80        ; Commando: Read sector
    60 00000039 E608                    OUT DISK_CMD, AL    ; Start lezen
    61                                  
    62                                  .wait_read:
    63 0000003B E408                    IN AL, DISK_STATUS  ; Lees de status
    64 0000003D A801                    TEST AL, 0x01       ; Controleer of data beschikbaar is
    65 0000003F 74FA                    JZ .wait_read       ; Wacht tot de data beschikbaar is
    66                                  
    67 00000041 B90002                  MOV CX, 512         ; Sector grootte: 512 bytes
    68                                  .read_byte:
    69 00000044 E40E                    IN AL, DISK_DATA    ; Lees een byte van de floppy
    70 00000046 268805                  MOV [ES:DI], AL     ; Sla de byte op in de buffer
    71 00000049 47                      INC DI              ; Verhoog de offset
    72 0000004A E2F8                    LOOP .read_byte     ; Herhaal totdat de sector gelezen is
    73                                  
    74 0000004C F4                      HLT                 ; Stop de uitvoering
    75                                  
    76                                  
    77                                  
    78                                  
    79                                  ; _1E4A:
    80                                  ;   mov al,0xD8
    81                                  ;   out DISK_CMD,al           ; floppy command: 0b11011000 (0xD8)
    82                                  
    83                                  ;   mov al,0x98
    84                                  ;   out PPI,al                ; PPI control: 0b10011000 (0x98) 'strobe'
    85                                  
    86                                  ; _1E52:
    87                                  ; mov ax,0xffff
    88                                  ;   stosw
    89                                  ;   stosw
    90                                  
    91                                  ;   in al,DISK_STATUS         ; floppy status
    92                                  ;   test al,0x01
    93                                  ;   jnz _1E52                 ; loop until bit 1 is high
    94                                  
    95                                  ; _1E58:
    96                                  ;   mov al,0x08
    97                                  ;   out DISK_CMD,al           ; floppy command 0b00001000
    98                                  ;   aam                       ; wait?
    99                                  ;   aam                       ; wait?
   100                                  ;   aam                       ; wait?
   101                                  ;   aam                       ; wait?
   102                                  
   103                                  ; _1E64:
   104                                  ;   in al,DISK_STATUS          ; floppy status dx=0x08
   105                                  ;   test al,0x01
   106                                  ;   jnz _1E64                  ; wait until bit 1 is high
   107                                  ;   test al,0x80
   108                                  ;   jnz _1E58                  ; wait until bit 7 is high
   109                                  
   110                                  ; _1E6E:
   111                                  ;   cld                        ; clear direction flag
   112                                  ;   mov al,0x01
   113                                  ;   out DISK_SECTOR,al         ; floppy set sector bit 1
   114                                    
   115                                    
   116                                    
   117                                  ;   mov dx,DISK_STATUS              ; used to read floppy status
   118                                  ;   mov si,_1EA0               ; used for local jmp later on
   119                                    
   120                                  ;   mov bh,0
   121                                  ;   mov ah,0
   122                                  ;   mov al,0
   123                                  ;   out DISK_CMD,al            ; floppy
   124                                    
   125                                  ;   aam
   126                                  ;   aam
   127                                  ;   aam
   128                                  ;   aam
   129                                  
   130                                  
   131                                  
   132                                  ; _1E91:
   133                                    
   134                                  
   135                                  ;   in al,dx
   136                                  ;   ; in al,DISK_STATUS              ; floppy status dx=0x08
   137                                  ;   sar al,1
   138                                  
   139                                  ;   jnc _1EB2            ; floppy
   140                                  ;   jnz _1E91            ; floppy
   141                                  
   142                                   
   143                                    
   144                                    
   145                                  
   146                                  ;   ; mov cx,10*2*72
   147                                  ;   ; rep stosw
   148                                  
   149                                  ;   ; hlt
   150                                  
   151                                  
   152                                  ; _1E98:
   153                                  ;   in al,dx              ; floppy dx=0x08
   154                                  ;   and al,bh             ; bit 2 (?)
   155                                  ;   jz _1E98  
   156                                  
   157                                  ; _1E9D:
   158                                  ;   in al,DISK_DATA            ; read data from floppy
   159                                  ;   stosb                 ; store in es:di++    
   160                                  
   161                                  ; _1EA0:
   162                                  ;   in al,dx              ; floppy dx=0x08
   163                                  ;   dec ax
   164                                  ;   cmp al,bh             ; bh = 2 ?
   165                                  ;   jnz _1EB2
   166                                  
   167                                  ; _1EA8:
   168                                  ;   in al,DISK_DATA            ; read data from floppy
   169                                  ;   stosb                 ; store in es:di++
   170                                  
   171                                  ;   in al,dx
   172                                  ;   cmp al,bh
   173                                  ;   jz _1EA8
   174                                  
   175                                  ; _1EB0:
   176                                  ; ; hlt
   177                                  ;   jmp si                ; jump to 0x1EA0
   178                                  
   179                                  ; _1EB2:
   180                                    
   181                                  ;   mov ax,0xff00
   182                                  ;   stosw
   183                                  ;   stosw
   184                                  
   185                                  ;   ; in al,dx              ; floppy status dx=0x08
   186                                  ;   ; test al,0x1C           
   187                                  ;   ; jnz _1E52            ; floppy status
   188                                  
   189                                  ; _1EBC:
   190                                    
   191                                  
   192                                  ;   ; jmp 0x0038:0
   193                                  ;   ; hlt
   194                                  
   195                                  
   196                                  img: 
   197 0000004D <bin 4E769h>              incbin "zwembad.jpg"
   198                                  
   199                                  %assign num $-$$
   200                                  %warning num
   200          ******************       warning: 321462 [-w+user]
   201                                  
   202 0004E7B6 00<rep B84Ah>           times 368640-num db  0
