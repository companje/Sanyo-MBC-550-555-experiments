var ah,al,ch,cl,dh,dl,bh,bl,sp,bp,si,di,cs,ds,ss,es,os,ip,flags,op,d,w,mod,reg,rm,ea,clocks,halt=!1;const CF=1,PF=4,AF=16,ZF=64,SF=128,TF=256,IF=512,DF=1024,OF=2048,B=0,W=1,AX=0,CX=1,DX=2,BX=3,MASK=[255,65535],PARITY=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1],BITS=[8,16],SIGN=[128,32768];function msb(a,b){return(b&SIGN[a])==SIGN[a]}function shift(b,a){return a>=0?b<<a:b>>> -a}function signconv(a,b){return b<<32-BITS[a]>>32-BITS[a]}var queue=[0,0,0,0,0,0];function adc(c,a,e){var f=(1&flags)==1?1:0,b=a+e+f&MASK[c];return setFlag(1,1==f?b<=a:b<a),setFlag(16,((b^a^e)&16)>0),setFlag(2048,(2048&shift((a^e^ -1)&(a^b),12-BITS[c]))>0),setFlags(c,b),b}function add(c,a,e){var b=a+e&MASK[c];return setFlag(1,b<a),setFlag(16,((b^a^e)&16)>0),setFlag(2048,(2048&shift((a^e^ -1)&(a^b),12-BITS[c]))>0),setFlags(c,b),b}function callInt(a){}function dec(b,c){var a=c-1&MASK[b];return setFlag(16,((a^c^1)&16)>0),setFlag(2048,a==SIGN[b]-1),setFlags(b,a),a}function decode(){mod=queue[1]>>>6&3,reg=queue[1]>>>3&7,rm=7&queue[1],ip=1==mod?ip+2&65535:0==mod&&6==rm||2==mod?ip+3&65535:ip+1&65535}function getAddr(a,b){return(a<<4)+b}function getEA(c,e){var a=0;1==c?(clocks+=4,a=queue[2]):2==c&&(clocks+=4,a=queue[3]<<8|queue[2]);var b=0;switch(e){case 0:clocks+=7,b=bh<<8|bl+si+a;break;case 1:clocks+=8,b=bh<<8|bl+di+a;break;case 2:clocks+=8,b=bp+si+a;break;case 3:clocks+=7,b=bp+di+a;break;case 4:clocks+=5,b=si+a;break;case 5:clocks+=5,b=di+a;break;case 6:0==c?(clocks+=6,b=queue[3]<<8|queue[2]):(clocks+=5,b=bp+a);break;case 7:clocks+=5,b=bh<<8|bl+a}return(os<<4)+(65535&b)}function getFlag(a){return(flags&a)>0}function getMem1(b){var a=getAddr(cs,ip);a>=memory.length&&console.log("illegal address",a,cs,ip);var c=memory[a];return b==W&&(c|=memory[a+1]<<8),ip=ip+1+b&65535,c}function getMem(b,a){if(void 0==a)return getMem1(b);var c=memory[a];return b==W&&((1&a)==1&&(clocks+=4),c|=memory[a+1]<<8),c}function getReg(b,a){if(0==b)switch(a){case 0:return al;case 1:return cl;case 2:return dl;case 3:return bl;case 4:return ah;case 5:return ch;case 6:return dh;case 7:return bh}else switch(a){case 0:return ah<<8|al;case 1:return ch<<8|cl;case 2:return dh<<8|dl;case 3:return bh<<8|bl;case 4:return sp;case 5:return bp;case 6:return si;case 7:return di}return 0}function getRM(a,b,c){return 3==b?getReg(a,c):getMem(a,ea>0?ea:getEA(b,c))}function getSegReg(a){switch(a){case 0:return es;case 1:return cs;case 2:return ss;case 3:return ds}return 0}function inc(b,c){var a=c+1&MASK[b];return setFlag(16,((a^c^1)&16)>0),setFlag(2048,a==SIGN[b]),setFlags(b,a),a}function logic(a,b){setFlag(1,!1),setFlag(2048,!1),setFlags(a,b)}function pop(){var a=getMem(W,getAddr(ss,sp));return sp=sp+2&65535,a}function push(a){setMem(W,getAddr(ss,sp=sp-2&65535),a)}function reset(){flags=0,ip=0,cs=65535,ds=0,ss=0,es=0;for(var a=0;a<6;a++)queue[a]=0;clocks=0}function sbb(e,a,b){var f=(1&flags)==1?1:0,c=a-b-f&MASK[e];return setFlag(1,f>0?a<=b:a<b),setFlag(16,((c^a^b)&16)>0),setFlag(2048,(2048&shift((a^b)&(a^c),12-BITS[e]))>0),setFlags(e,c),c}function setFlag(a,b){b?flags|=a:flags&=~a}function setFlags(b,a){setFlag(4,PARITY[255&a]>0),setFlag(64,0==a),setFlag(128,(128&shift(a,8-BITS[b]))>0)}function setMem(c,a,b){memory[a]=255&b,c==W&&((1&a)==1&&(clocks+=4),memory[a+1]=b>>>8&255)}function setReg(c,b,a){if(0==c)switch(b){case 0:al=255&a;break;case 1:cl=255&a;break;case 2:dl=255&a;break;case 3:bl=255&a;break;case 4:ah=255&a;break;case 5:ch=255&a;break;case 6:dh=255&a;break;case 7:bh=255&a}else switch(b){case 0:al=255&a,ah=a>>>8&255;break;case 1:cl=255&a,ch=a>>>8&255;break;case 2:dl=255&a,dh=a>>>8&255;break;case 3:bl=255&a,bh=a>>>8&255;break;case 4:sp=65535&a;break;case 5:bp=65535&a;break;case 6:si=65535&a;break;case 7:di=65535&a}}function setRM(a,b,c,e){3==b?setReg(a,c,e):setMem(a,ea>0?ea:getEA(b,c),e)}function setSegReg(b,a){switch(b){case 0:es=65535&a;break;case 1:cs=65535&a;break;case 2:ss=65535&a;break;case 3:ds=65535&a}}function sub(e,a,b){var c=a-b&MASK[e];return setFlag(1,a<b),setFlag(16,((c^a^b)&16)>0),setFlag(2048,(2048&shift((a^b)&(a^c),12-BITS[e]))>0),setFlags(e,c),c}function tick(){os=ds;var g=0;prefixes:for(;;)switch(getMem(0)){case 38:os=es,clocks+=2;break;case 46:os=cs,clocks+=2;break;case 54:os=ss,clocks+=2;break;case 62:os=ds,clocks+=2;break;case 242:g=2,clocks+=9;break;case 243:g=1,clocks+=9;break;default:ip=ip-1&65535;break prefixes}for(var k=0;k<6;++k)queue[k]=getMem(0,getAddr(cs,ip+k));switch(d=(op=queue[0])>>>1&1,w=1&op,ip=ip+1&65535,op){case 164:case 165:case 170:case 171:0==g&& ++clocks;break;case 166:case 167:case 174:case 175:break;case 172:case 173:0==g&& --clocks;break;default:g=0}do{if(g>0){var m=getReg(W,CX);if(0==m)break;setReg(W,CX,m-1)}for(;clocks>3;)clocks-=4;switch(ea=-1,op){case 136:case 137:case 138:case 139:decode(),0==d?(b=getReg(w,reg),setRM(w,mod,rm,b),clocks+=3==mod?2:9):(b=getRM(w,mod,rm),setReg(w,reg,b),clocks+=3==mod?2:8);break;case 198:case 199:decode(),0===reg&&(b=getMem(w),setRM(w,mod,rm,b)),clocks+=3==mod?4:10;break;case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:w=op>>>3&1,reg=7&op,b=getMem(w),setReg(w,reg,b),clocks+=4;break;case 160:case 161:case 162:case 163:a=getMem(W),0==d?(b=getMem(w,getAddr(os,a)),setReg(w,AX,b)):(b=getReg(w,AX),setMem(w,getAddr(os,a),b)),clocks+=10;break;case 140:case 142:decode(),0==d?(b=getSegReg(reg),setRM(W,mod,rm,b),clocks+=3==mod?2:9):(setSegReg(reg,b=getRM(W,mod,rm)),clocks+=3==mod?2:8);break;case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:push(b=getReg(W,reg=7&op)),clocks+=11;break;case 6:case 14:case 22:case 30:push(b=getSegReg(reg=op>>>3&7)),clocks+=10;break;case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:reg=7&op,b=pop(),setReg(W,reg,b),clocks+=8;break;case 7:case 15:case 23:case 31:setSegReg(reg=op>>>3&7,b=pop()),clocks+=8;break;case 134:case 135:decode(),a=getReg(w,reg),b=getRM(w,mod,rm),setReg(w,reg,b),setRM(w,mod,rm,a),clocks+=3==mod?3:17;break;case 145:case 146:case 147:case 148:case 149:case 150:case 151:reg=7&op,a=getReg(W,AX),b=getReg(W,reg),setReg(W,AX,b),setReg(W,reg,a),clocks+=3;break;case 215:al=getMem(0,getAddr(os,getReg(W,3)+al)),clocks+=11;break;case 228:case 229:b=getMem(0),setReg(w,AX,portIn(w,b)),clocks+=10,w==W&&(1&b)==1&&(clocks+=4);break;case 236:case 237:b=getReg(W,DX),setReg(w,AX,portIn(w,b)),clocks+=8,w==W&&(1&b)==1&&(clocks+=4);break;case 230:case 231:portOut(w,b=getMem(0),getReg(w,AX)),clocks+=10,w==W&&(1&b)==1&&(clocks+=4);break;case 238:case 239:portOut(w,b=getReg(W,DX),getReg(w,AX)),clocks+=8,w==W&&(1&b)==1&&(clocks+=4);break;case 141:decode(),setReg(w,reg,b=getEA(mod,rm)-(os<<4)),clocks+=2;break;case 197:decode(),setReg(w,reg,getMem(W,b=getEA(mod,rm))),ds=getMem(W,b+2),clocks+=16;break;case 196:decode(),setReg(w,reg,getMem(W,b=getEA(mod,rm))),es=getMem(W,b+2),clocks+=16;break;case 159:ah=255&flags,clocks+=4;break;case 158:flags=65280&flags|ah,clocks+=4;break;case 156:push(flags),clocks+=10;break;case 157:flags=pop(),clocks+=8;break;case 0:case 1:case 2:case 3:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),e=add(w,a,b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 4:case 5:a=getReg(w,0),b=getMem(w),e=add(w,a,b),setReg(w,AX,e),clocks+=4;break;case 16:case 17:case 18:case 19:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),e=adc(w,a,b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 20:case 21:a=getReg(w,AX),b=getMem(w),e=adc(w,a,b),setReg(w,AX,e),clocks+=4;break;case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:b=getReg(W,reg=7&op),e=inc(W,b),setReg(W,reg,e),clocks+=2;break;case 55:(15&al)>9||getFlag(16)?(al+=6,ah=ah+1&255,setFlag(1,!0),setFlag(16,!0)):(setFlag(1,!1),setFlag(16,!1)),al&=15,clocks+=4;break;case 39:var l=al,j=getFlag(1);setFlag(1,!1),(15&al)>9||getFlag(16)?(al+=6,setFlag(1,j||al<0),al&=255,setFlag(16,!0)):setFlag(16,!1),l>153||j?(al=al+96&255,setFlag(1,!0)):setFlag(1,!1),setFlags(0,al),clocks+=4;break;case 40:case 41:case 42:case 43:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),e=sub(w,a,b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 44:case 45:a=getReg(w,AX),b=getMem(w),e=sub(w,a,b),setReg(w,AX,e),clocks+=4;break;case 24:case 25:case 26:case 27:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),e=sbb(w,a,b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 28:case 29:a=getReg(w,AX),b=getMem(w),e=sbb(w,a,b),setReg(w,AX,e),clocks+=4;break;case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:a=getReg(W,reg=7&op),e=dec(W,a),setReg(W,reg,e),clocks+=2;break;case 56:case 57:case 58:case 59:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),sub(w,a,b),clocks+=3==mod?3:9;break;case 60:case 61:a=getReg(w,AX),b=getMem(w),sub(w,a,b),clocks+=4;break;case 63:(15&al)>9||getFlag(16)?(al-=6,ah=ah-1&255,setFlag(1,!0),setFlag(16,!0)):(setFlag(1,!1),setFlag(16,!1)),al&=15,clocks+=4;break;case 47:var l=al,j=getFlag(1);setFlag(1,!1),(15&al)>9||getFlag(16)?(al-=6,setFlag(1,j||(255&al)>0),al&=255,setFlag(16,!0)):setFlag(16,!1),l>153||j?(al=al-96&255,setFlag(1,!0)):setFlag(1,!1),setFlags(0,al),clocks+=4;break;case 212:0==(b=getMem(0))?callInt(0):(ah=al/b&255,al=al%b&255,setFlags(W,getReg(W,AX)),clocks+=83);break;case 213:b=getMem(0),al=ah*b+al&255,ah=0,setFlags(0,al),clocks+=60;break;case 152:ah=(128&al)==128?255:0,clocks+=2;break;case 153:(128&ah)==128?setReg(W,DX,65535):setReg(W,DX,0),clocks+=5;break;case 32:case 33:case 34:case 35:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),logic(w,e=a&b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 36:case 37:a=getReg(w,AX),b=getMem(w),logic(w,e=a&b),setReg(w,AX,e),clocks+=4;break;case 8:case 9:case 10:case 11:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),logic(w,e=a|b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 12:case 13:a=getReg(w,AX),b=getMem(w),logic(w,e=a|b),setReg(w,AX,e),clocks+=4;break;case 48:case 49:case 50:case 51:decode(),0==d?(a=getRM(w,mod,rm),b=getReg(w,reg)):(a=getReg(w,reg),b=getRM(w,mod,rm)),logic(w,e=a^b),0==d?(setRM(w,mod,rm,e),clocks+=3==mod?3:16):(setReg(w,reg,e),clocks+=3==mod?3:9);break;case 52:case 53:a=getReg(w,AX),b=getMem(w),logic(w,e=a^b),setReg(w,AX,e),clocks+=4;break;case 132:case 133:decode(),a=getRM(w,mod,rm),b=getReg(w,reg),logic(w,a&b),clocks+=3==mod?3:9;break;case 168:case 169:a=getReg(w,AX),b=getMem(w),logic(w,a&b),clocks+=4;break;case 164:case 165:b=getMem(w,getAddr(os,si)),setMem(w,getAddr(es,di),b),si=si+(getFlag(1024)?-1:1)*(1+w)&65535,di=di+(getFlag(1024)?-1:1)*(1+w)&65535,clocks+=17;break;case 166:case 167:a=getMem(w,getAddr(es,di)),b=getMem(w,getAddr(os,si)),sub(w,b,a),si=si+(getFlag(1024)?-1:1)*(1+w)&65535,di=di+(getFlag(1024)?-1:1)*(1+w)&65535,(1==g&&!getFlag(64)||2==g&&getFlag(64))&&(g=0),clocks+=22;break;case 174:case 175:a=getMem(w,getAddr(es,di)),b=getReg(w,AX),sub(w,b,a),di=di+(getFlag(1024)?-1:1)*(1+w)&65535,(1==g&&!getFlag(64)||2==g&&getFlag(64))&&(g=0),clocks+=15;break;case 172:case 173:b=getMem(w,getAddr(os,si)),setReg(w,AX,b),si=si+(getFlag(1024)?-1:1)*(1+w)&65535,clocks+=13;break;case 170:case 171:b=getReg(w,AX),setMem(w,getAddr(es,di),b),di=di+(getFlag(1024)?-1:1)*(1+w)&65535,clocks+=10;break;case 232:a=getMem(W),a=signconv(W,a),push(ip),ip=ip+a&65535,clocks+=19;break;case 154:a=getMem(W),b=getMem(W),push(cs),push(ip),ip=a,cs=b,clocks+=28;break;case 195:ip=pop(),clocks+=8;break;case 194:b=getMem(W),ip=pop(),sp+=b,clocks+=12;break;case 203:ip=pop(),cs=pop(),clocks+=18;break;case 202:b=getMem(W),ip=pop(),cs=pop(),sp+=b,clocks+=17;break;case 233:a=getMem(W),a=signconv(W,a),ip=ip+a&65535,clocks+=15;break;case 235:a=signconv(0,a=getMem(0)),ip=ip+a&65535,clocks+=15;break;case 234:a=getMem(W),b=getMem(W),ip=a,cs=b,clocks+=15;break;case 112:a=signconv(0,a=getMem(0)),getFlag(2048)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 113:a=signconv(0,a=getMem(0)),getFlag(2048)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 114:a=signconv(0,a=getMem(0)),getFlag(1)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 115:a=signconv(0,a=getMem(0)),getFlag(1)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 116:a=signconv(0,a=getMem(0)),getFlag(64)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 117:a=signconv(0,a=getMem(0)),getFlag(64)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 118:a=signconv(0,a=getMem(0)),getFlag(1)|getFlag(64)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 119:a=signconv(0,a=getMem(0)),getFlag(1)|getFlag(64)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 120:a=signconv(0,a=getMem(0)),getFlag(128)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 121:a=signconv(0,a=getMem(0)),getFlag(128)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 122:a=signconv(0,a=getMem(0)),getFlag(4)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 123:a=signconv(0,a=getMem(0)),getFlag(4)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 124:a=signconv(0,a=getMem(0)),getFlag(128)^getFlag(2048)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 125:a=signconv(0,a=getMem(0)),getFlag(128)^getFlag(2048)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 126:a=signconv(0,a=getMem(0)),getFlag(128)^getFlag(2048)|getFlag(64)?(ip=ip+a&65535,clocks+=16):clocks+=4;break;case 127:a=signconv(0,a=getMem(0)),getFlag(128)^getFlag(2048)|getFlag(64)?clocks+=4:(ip=ip+a&65535,clocks+=16);break;case 226:a=signconv(0,a=getMem(0)),b=getReg(W,CX)-1&65535,setReg(W,CX,b),0!=b?(ip=ip+a&65535,clocks+=17):clocks+=5;break;case 225:a=signconv(0,a=getMem(0)),b=getReg(W,CX)-1&65535,setReg(W,CX,b),0!=b&&getFlag(64)?(ip=ip+a&65535,clocks+=18):clocks+=6;break;case 224:a=signconv(0,a=getMem(0)),b=getReg(W,CX)-1&65535,setReg(W,CX,b),0==b||getFlag(64)?clocks+=5:(ip=ip+a&65535,clocks+=19);break;case 227:a=signconv(0,a=getMem(0)),0==getReg(W,CX)?(ip=ip+a&65535,clocks+=18):clocks+=6;break;case 204:case 205:callInt(204==op?3:getMem(0)),clocks+=204==op?52:51;break;case 206:getFlag(2048)?(callInt(4),clocks+=53):clocks+=4;break;case 207:ip=pop(),cs=pop(),flags=pop(),clocks+=24;break;case 248:setFlag(1,!1),clocks+=2;break;case 245:setFlag(1,!getFlag(1)),clocks+=2;break;case 249:setFlag(1,!0),clocks+=2;break;case 252:setFlag(1024,!1),clocks+=2;break;case 253:setFlag(1024,!0),clocks+=2;break;case 250:setFlag(512,!1),clocks+=2;break;case 251:setFlag(512,!0),clocks+=2;break;case 244:return clocks+=2,halt=!0,!1;case 155:case 144:clocks+=3;break;case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:decode(),clocks+=3==mod?2:8;break;case 240:clocks+=2;break;case 128:case 129:case 130:case 131:switch(decode(),a=getRM(w,mod,rm),b=getMem(0),129==op?b|=getMem(0)<<8:131==op&&(b&SIGN[0])>0&&(b|=65280),reg){case 0:e=add(w,a,b),setRM(w,mod,rm,e);break;case 1:(128==op||129==op)&&(logic(w,e=a|b),setRM(w,mod,rm,e));break;case 2:e=adc(w,a,b),setRM(w,mod,rm,e);break;case 3:e=sbb(w,a,b),setRM(w,mod,rm,e);break;case 4:(128==op||129==op)&&(logic(w,e=a&b),setRM(w,mod,rm,e));break;case 5:e=sub(w,a,b),setRM(w,mod,rm,e);break;case 6:(128==op||129==op)&&(logic(w,e=a^b),setRM(w,mod,rm,e));break;case 7:sub(w,a,b),3==mod&&(clocks-=7)}clocks+=3==mod?4:17;break;case 143:decode(),0===reg&&setRM(w,mod,rm,b=pop()),clocks+=3==mod?8:17;break;case 208:case 209:case 210:case 211:switch(decode(),a=getRM(w,mod,rm),b=208==op||209==op?1:cl,reg){case 0:for(var a,b,e,h,c=0;c<b;++c)h=msb(w,a),a<<=1,a|=h?1:0,a&=MASK[w];setFlag(1,(1&a)==1),1==b&&setFlag(2048,msb(w,a)^getFlag(1));break;case 1:for(var c=0;c<b;++c)h=(1&a)==1,a>>>=1,a|=(h?1:0)*SIGN[w],a&=MASK[w];setFlag(1,msb(w,a)),1==b&&setFlag(2048,msb(w,a)^msb(w,a<<1));break;case 2:for(var c=0;c<b;++c)h=msb(w,a),a<<=1,a|=getFlag(1)?1:0,a&=MASK[w],setFlag(1,h);1==b&&setFlag(2048,msb(w,a)^getFlag(1));break;case 3:1==b&&setFlag(2048,msb(w,a)^getFlag(1));for(var c=0;c<b;++c)h=(1&a)==1,a>>>=1,a|=(getFlag(1)?1:0)*SIGN[w],a&=MASK[w],setFlag(1,h);break;case 4:for(var c=0;c<b;++c)setFlag(1,(a&SIGN[w])==SIGN[w]),a<<=1,a&=MASK[w];1==b&&setFlag(2048,(a&SIGN[w])==SIGN[w]^getFlag(1)),b>0&&setFlags(w,a);break;case 5:1==b&&setFlag(2048,(a&SIGN[w])==SIGN[w]);for(var c=0;c<b;++c)setFlag(1,(1&a)==1),a>>>=1,a&=MASK[w];b>0&&setFlags(w,a);break;case 7:1==b&&setFlag(2048,!1);for(var c=0;c<b;++c)setFlag(1,(1&a)==1),a=signconv(w,a),a>>=1,a&=MASK[w];b>0&&setFlags(w,a)}setRM(w,mod,rm,a),208==op||209==op?clocks+=3==mod?2:15:clocks+=3==mod?8+4*b:20+4*b;break;case 246:case 247:switch(decode(),b=getRM(w,mod,rm),reg){case 0:a=getMem(w),logic(w,a&b),clocks+=3==mod?5:11;break;case 2:setRM(w,mod,rm,~b),clocks+=3==mod?3:16;break;case 3:a=sub(w,0,b),setFlag(1,a>0),setRM(w,mod,rm,a),clocks+=3==mod?3:16;break;case 4:if(0==w)setReg(W,AX,e=(a=al)*b&65535),ah>0?(setFlag(1,!0),setFlag(2048,!0)):(setFlag(1,!1),setFlag(2048,!1)),clocks+=3.5;else{var f=(a=getReg(W,AX))*b&4294967295;setReg(W,AX,f),setReg(W,DX,f>>>16),getReg(W,DX)>0?(setFlag(1,!0),setFlag(2048,!0)):(setFlag(1,!1),setFlag(2048,!1)),clocks+=7.5}break;case 5:if(0==w)b=signconv(0,b),setReg(W,AX,e=(a=signconv(0,a=al))*b&65535),ah>0&&ah<255?(setFlag(1,!0),setFlag(2048,!0)):(setFlag(1,!1),setFlag(2048,!1)),clocks+=3==mod?9:13;else{b=signconv(W,b);var f=(a=signconv(W,a=ah<<8|al))*b&4294967295;setReg(W,AX,f),setReg(W,DX,f>>>16);var n=getReg(W,DX);n>0&&n<65535?(setFlag(1,!0),setFlag(2048,!0)):(setFlag(1,!1),setFlag(2048,!1)),clocks+=3==mod?9:13}break;case 6:if(0==b)callInt(0);else if(0==w)(e=(a=ah<<8|al)/b&65535)>255?callInt(0):(al=255&e,ah=a%b&255),clocks+=5;else{var i=getReg(W,DX)<<16|getReg(W,AX),f=i/b&4294967295;f>65535?callInt(0):(setReg(W,AX,f),setReg(W,DX,f=i%b&65535)),clocks+=9}break;case 7:if(0==b)callInt(0);else if(0==w)b=signconv(0,b),a=getReg(W,AX),(e=(a=signconv(W,a))/b&65535)>127&&e<65409?callInt(0):(al=255&e,ah=a%b&255),clocks+=5.5;else{b=signconv(W,b);var i=getReg(W,DX)<<16|getReg(W,AX),f=(i=i<<32>>32)/b&4294967295;f>32767||f<4294934528?callInt(0):(setReg(W,AX,f),setReg(W,DX,f=i%b&65535)),clocks+=9.5}}break;case 254:switch(decode(),b=getRM(w,mod,rm),reg){case 0:e=inc(w,b),setRM(w,mod,rm,e);break;case 1:e=dec(w,b),setRM(w,mod,rm,e)}clocks+=3==mod?3:15;break;case 255:switch(decode(),b=getRM(w,mod,rm),reg){case 0:e=inc(w,b),setRM(w,mod,rm,e),clocks+=3==mod?3:15;break;case 1:e=dec(w,b),setRM(w,mod,rm,e),clocks+=3==mod?3:15;break;case 2:push(ip),ip=b,clocks+=3==mod?16:21;break;case 3:push(cs),push(ip),ip=getMem(W,a=getEA(mod,rm)),cs=getMem(W,a+2),clocks+=37;break;case 4:ip=b,clocks+=3==mod?11:18;break;case 5:ip=getMem(W,a=getEA(mod,rm)),cs=getMem(W,a+2),clocks+=24;break;case 6:push(b),clocks+=3==mod?11:16}}}while(g>0)return!0}