     1                                  	org 0x100
     2                                  setup:
     3 00000000 B80200                  	mov ax,0x0002
     4 00000003 CD10                    	int 0x10
     5 00000005 B8003C                  	mov ax,0x3c00
     6 00000008 8EC0                    	mov es,ax
     7 0000000A 31ED                    	xor bp,bp
     8 0000000C B600                    	mov dh,0	; t
     9                                  draw:
    10 0000000E B200                    	mov dl,0	; i
    11 00000010 B300                    	mov bl,0	; y
    12 00000012 BF900B                  	mov di,9*320+80	; view top left
    13                                  repeatY:
    14 00000015 B700                    	mov bh,0	; x
    15                                  repeatX:
    16 00000017 55                      	push bp
    17 00000018 53                      	push bx
    18 00000019 87DD                    	xchg bx,bp
    19 0000001B 8BAF[A900]              	mov bp,[bx+table]
    20 0000001F 81E5FF00                	and bp,0xff
    21 00000023 81CD0001                	or bp,0x100
    22 00000027 5B                      	pop bx
    23 00000028 FFD5                    	call bp
    24 0000002A 5D                      	pop bp
    25                                  
    26 0000002B 53                      	push bx
    27 0000002C 3C00                    	cmp al,0
    28 0000002E 7D16                    	jge white
    29                                  gray:
    30 00000030 BB00F4                  	mov bx,0xf400
    31 00000033 8EC3                    	mov es,bx
    32 00000035 F6D8                    	neg al
    33 00000037 E84C00                  	call drawchar
    34 0000003A BB003C                  	mov bx,0x3c00
    35 0000003D 8EC3                    	mov es,bx
    36 0000003F B000                    	mov al,0
    37 00000041 E84200                  	call drawchar
    38 00000044 EB10                    	jmp nextchar
    39                                  white:
    40 00000046 BB003C                  	mov bx,0x3c00
    41 00000049 8EC3                    	mov es,bx
    42 0000004B E83800                  	call drawchar
    43 0000004E BB00F4                  	mov bx,0xf400
    44 00000051 8EC3                    	mov es,bx
    45 00000053 E83000                  	call drawchar
    46                                  
    47                                  nextchar:
    48 00000056 5B                      	pop bx
    49 00000057 83C708                  	add di,8
    50 0000005A FEC2                    	inc dl		; i++
    51 0000005C FEC7                    	inc bh		; x++
    52 0000005E 80FF10                  	cmp bh,16
    53 00000061 7CB4                    	jl repeatX
    54 00000063 81C70002                	add di,192+320
    55 00000067 FEC3                    	inc bl		; y++
    56 00000069 80FB10                  	cmp bl,16
    57 0000006C 7CA7                    	jl repeatY
    58                                  
    59                                  key:
    60 0000006E E438                    	in al,0x38
    61 00000070 3C1B                    	cmp al,0x1b
    62 00000072 740C                    	je end
    63 00000074 B400                    	mov ah,0
    64 00000076 2C30                    	sub al,0x30
    65 00000078 2407                    	and al,7
    66 0000007A 89C5                    	mov bp,ax
    67                                  
    68 0000007C FEC6                    	inc dh		; t++
    69 0000007E EB8E                    	jmp draw
    70                                  
    71                                  end:
    72 00000080 B400                    	mov ah,0
    73 00000082 CD16                    	int 0x16
    74 00000084 CD20                    	int 0x20
    75                                  
    76                                  drawchar:
    77 00000086 57                      	push di
    78 00000087 50                      	push ax
    79 00000088 240F                    	and al,15	; limit to 4 lower bits [0..15]
    80 0000008A B108                    	mov cl,8
    81 0000008C F6E1                    	mul cl		; ax=al*8
    82                                  
    83 0000008E 89C6                    	mov si,ax
    84 00000090 81C6[E800]              	add si,img
    85 00000094 A5                      	movsw
    86 00000095 A5                      	movsw
    87 00000096 A5                      	movsw
    88 00000097 A5                      	movsw
    89 00000098 81C73801                	add di,320-8
    90 0000009C 89C6                    	mov si,ax
    91 0000009E 81C6[6801]              	add si,img+128
    92 000000A2 A5                      	movsw
    93 000000A3 A5                      	movsw
    94 000000A4 A5                      	movsw
    95 000000A5 A5                      	movsw
    96                                  ;sub di,320-8
    97 000000A6 58                      	pop ax
    98 000000A7 5F                      	pop di
    99 000000A8 C3                      	ret
   100                                  
   101 000000A9 [B1][BD][C4][C7]-       table:	db fx0,fx1,fx2,fx3,fx4,fx5,fx6,fx7
   101 000000AD [CA][CF][E0][E5]   
   102                                  
   103                                  fx0:			; sierpinsky triangle
   104 000000B1 88D8                    	mov al,bl
   105 000000B3 00F0                    	add al,dh
   106 000000B5 20F8                    	and al,bh
   107 000000B7 9F                      	lahf
   108 000000B8 86E0                    	xchg ah,al
   109 000000BA 2440                    	and al,0x40
   110 000000BC C3                      	ret
   111                                  
   112                                  fx1:			; x*y+t
   113 000000BD 88F8                    	mov al,bh
   114 000000BF F6E3                    	mul bl
   115 000000C1 00F0                    	add al,dh
   116 000000C3 C3                      	ret
   117                                  
   118                                  fx2:			; noise from timer
   119 000000C4 E422                    	in al,0x22
   120 000000C6 C3                      	ret
   121                                  
   122                                  fx3:
   123 000000C7 E420                    	in al,0x20	; 0x20 0x22 0x24 are timers
   124 000000C9 C3                      	ret
   125                                  
   126                                  fx4:			; y-x
   127 000000CA 88D8                    	mov al,bl
   128 000000CC 28F8                    	sub al,bh
   129 000000CE C3                      	ret
   130                                  
   131                                  fx5:			; poging tot binary clock
   132 000000CF 88F0                    	mov al,dh
   133 000000D1 88F9                    	mov cl,bh
   134 000000D3 B501                    	mov ch,1
   135 000000D5 D2E5                    	shl ch,cl
   136 000000D7 20E8                    	and al,ch
   137 000000D9 D0E8                    	shr al,1
   138 000000DB D0E8                    	shr al,1
   139 000000DD D0E8                    	shr al,1
   140 000000DF C3                      	ret
   141                                  
   142                                  fx6:			; x-y
   143 000000E0 88F8                    	mov al,bh
   144 000000E2 28D8                    	sub al,bl
   145 000000E4 C3                      	ret
   146                                  
   147                                  fx7:
   148 000000E5 B0FF                    	mov al,-1
   149 000000E7 C3                      	ret
   150                                  img:
   151 000000E8 000000000000000000-     	db 0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,128
   151 000000F1 00000000000080     
   152 000000F8 00000001000000C000-     	db 0,0,0,1,  0,0,0,192,  0,0,0,1,  0,0,0,192
   152 00000101 000001000000C0     
   153 00000108 00000003000080E000-     	db 0,0,0,3,  0,0,128,224,  0,0,0,3,  0,0,128,224
   153 00000111 000003000080E0     
   154 00000118 000003070000E0F000-     	db 0,0,3,7,  0,0,224,240,  0,0,3,7,  0,0,224,240
   154 00000121 0003070000E0F0     
   155 00000128 0000070F0080F0F800-     	db 0,0,7,15,  0,128,240,248,  0,0,7,15,  0,128,240,248
   155 00000131 00070F0080F0F8     
   156 00000138 00030F1F00E0F8FC00-     	db 0,3,15,31,  0,224,248,252,  0,7,31,31,  0,240,252,252
   156 00000141 071F1F00F0FCFC     
   157 00000148 000F1F3F80F8FCFE00-     	db 0,15,31,63,  128,248,252,254,  0,15,63,63,  128,248,254,254
   157 00000151 0F3F3F80F8FEFE     
   158 00000158 071F3F7FF0FCFEFF07-     	db 7,31,63,127, 240,252,254,255, 7,63,127,127, 240,254,255,255
   158 00000161 3F7F7FF0FEFFFF     
   159 00000168 000000000000000000-     	db 0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0
   159 00000171 00000000000000     
   160 00000178 000000000000000000-     	db 0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0
   160 00000181 00000000000000     
   161 00000188 000000008000000000-     	db 0,0,0,0,  128,0,0,0,  0,0,0,0,  128,0,0,0
   161 00000191 00000080000000     
   162 00000198 03000000E000000003-     	db 3,0,0,0,  224,0,0,0,  3,0,0,0,  224,0,0,0
   162 000001A1 000000E0000000     
   163 000001A8 07000000F080000007-     	db 7,0,0,0,  240,128,0,0,  7,0,0,0,  240,128,0,0
   163 000001B1 000000F0800000     
   164 000001B8 0F030000F8E000001F-     	db 15,3,0,0,  248,224,0,0,  31,7,0,0,  252,240,0,0
   164 000001C1 070000FCF00000     
   165 000001C8 1F0F0000FCF880003F-     	db 31,15,0,0,  252,248,128,0,  63,15,0,0,  254,248,128,0
   165 000001D1 0F0000FEF88000     
   166 000001D8 3F1F0700FEFCF0007F-     	db 63,31,7,0,  254,252,240,0,  127,63,7,0,  255,254,240,0
   166 000001E1 3F0700FFFEF000     
   167                                  
   168                                  
